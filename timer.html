<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Countdown Timer</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom font import for a modern look */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* Light gray background */
        }
        /* Custom utility for table font to ensure alignment */
        .monospace-table {
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center p-4 bg-gray-50">

    <div class="w-full max-w-2xl bg-white shadow-xl rounded-2xl p-6 md:p-10">
        
        <!-- 0. Dynamic Title Display -->
        <h1 id="main-title" class="text-4xl md:text-5xl font-extrabold text-center text-gray-800 mb-6">
            Folding test
        </h1>

        <!-- 1. Input Section - This entire section will hide after setting the timer -->
        <div id="input-section">
            <!-- Title Input -->
            <div class="mb-6 p-4 bg-yellow-50 rounded-lg shadow-inner">
                <label for="title-input" class="font-bold text-lg text-gray-700 block mb-2">Change Timer Title:</label>
                <input id="title-input" type="text" value="Folding test"
                       class="w-full p-2 text-xl rounded-lg border-2 border-yellow-300 focus:border-yellow-500 transition"
                       placeholder="Enter new title"/>
                <!-- UPDATED DEFAULT VALUE -->
            </div>

            <!-- Time Input -->
            <div class="flex flex-col sm:flex-row items-center justify-center p-4 bg-blue-50 rounded-lg shadow-inner mb-8">
                <label class="font-bold text-lg text-gray-700 mb-2 sm:mb-0 sm:mr-4">Set Time (HH:MM:SS):</label>
                <div class="flex items-center space-x-2">
                    <input id="h-input" type="number" min="0" max="99" value="01" class="w-16 p-2 text-center text-xl font-bold rounded-lg border-2 border-blue-300 focus:border-blue-500 transition"/>
                    <span class="text-xl font-bold text-gray-700">:</span>
                    <input id="m-input" type="number" min="0" max="59" value="30" class="w-16 p-2 text-center text-xl font-bold rounded-lg border-2 border-blue-300 focus:border-blue-500 transition"/>
                    <span class="text-xl font-bold text-gray-700">:</span>
                    <input id="s-input" type="number" min="0" max="59" value="00" class="w-16 p-2 text-center text-xl font-bold rounded-lg border-2 border-blue-300 focus:border-blue-500 transition"/>
                </div>
                <button id="set-button" onclick="setTimer()" 
                        class="mt-4 sm:mt-0 sm:ml-6 px-6 py-2 bg-green-600 text-white font-bold rounded-xl shadow-lg hover:bg-green-700 transition transform hover:scale-105 active:scale-95">
                    Set Timer
                </button>
            </div>
        </div>

        <!-- 2. Timer Display -->
        <div id="timer-display-container" class="p-4 sm:p-6 bg-gray-900 rounded-2xl shadow-2xl mb-8 hidden">
            <!-- Font size adjusted for responsiveness -->
            <p id="timer-display" class="text-5xl sm:text-6xl md:text-8xl lg:text-8xl font-black text-center text-green-400 monospace-table">
                01:30:00.0
            </p>
        </div>
        
        <!-- 3. Control Button -->
        <button id="submit-button" onclick="showNameModal()" disabled
                class="w-full px-8 py-4 bg-blue-600 text-white font-extrabold text-xl rounded-xl shadow-xl hover:bg-blue-700 transition transform hover:scale-[1.02] active:scale-95 disabled:bg-gray-400 disabled:shadow-none mb-10">
            Submit (Record Time)
        </button>
        
        <!-- 4. Records Display Table -->
        <h2 class="text-2xl font-bold text-gray-700 mb-4">Submission Log</h2>
        <div class="overflow-x-auto bg-gray-100 rounded-lg border border-gray-300 shadow-inner">
            <table class="min-w-full divide-y divide-gray-300">
                <thead class="bg-gray-200">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">
                            Name
                        </th>
                        <th class="px-6 py-3 text-right text-xs font-bold text-gray-700 uppercase tracking-wider">
                            Time Remaining
                        </th>
                    </tr>
                </thead>
                <tbody id="records-body" class="bg-white divide-y divide-gray-200 monospace-table">
                    <!-- Records will be inserted here -->
                </tbody>
            </table>
            <p id="no-records-message" class="text-center text-gray-500 py-4 italic">No submissions yet.</p>
        </div>
    </div>
    
    <!-- Custom Name Input Modal -->
    <div id="name-modal-overlay" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white p-8 rounded-xl shadow-2xl w-full max-w-sm">
            <h3 class="text-xl font-bold text-gray-800 mb-4">Record Submission</h3>
            <label for="student-name-input" class="block text-gray-600 mb-2">Enter student's name:</label>
            <input id="student-name-input" type="text" 
                   class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-1 focus:ring-blue-500 mb-4 transition" 
                   placeholder="e.g. Chiang, Shum, Her"
                   onkeydown="if(event.key === 'Enter') handleModalSubmit();"/>
            <!-- UPDATED PLACEHOLDER -->
            <div class="flex justify-end space-x-3">
                <button onclick="hideNameModal()" class="px-4 py-2 text-gray-600 rounded-lg hover:bg-gray-100 transition">Cancel</button>
                <button onclick="handleModalSubmit()" class="px-4 py-2 bg-blue-600 text-white font-semibold rounded-lg shadow hover:bg-blue-700 transition transform hover:scale-105 active:scale-95">Save Record</button>
            </div>
        </div>
    </div>

    <script>
        // --- Global State ---
        let targetEndTime = null;
        let isRunning = false;
        let timerInterval = null;
        
        // --- Element References ---
        const titleInput = document.getElementById('title-input');
        const mainTitle = document.getElementById('main-title');
        const hInput = document.getElementById('h-input');
        const mInput = document.getElementById('m-input');
        const sInput = document.getElementById('s-input');
        const timerDisplay = document.getElementById('timer-display');
        const timerDisplayContainer = document.getElementById('timer-display-container'); // New container reference
        const inputSection = document.getElementById('input-section'); // New section reference
        const setButton = document.getElementById('set-button');
        const submitButton = document.getElementById('submit-button');
        const recordsBody = document.getElementById('records-body');
        const noRecordsMessage = document.getElementById('no-records-message');
        
        // Modal Element References
        const nameModalOverlay = document.getElementById('name-modal-overlay');
        const studentNameInput = document.getElementById('student-name-input');


        // --- Modal Logic (Unchanged) ---

        /**
         * Shows the custom modal for name input.
         */
        function showNameModal() {
            if (!isRunning) {
                alertMessage("The timer is not running.");
                return;
            }
            // Show the modal overlay
            nameModalOverlay.classList.remove('hidden');
            nameModalOverlay.classList.add('flex');
            // Focus the input field for immediate typing
            studentNameInput.focus();
        }

        /**
         * Hides the custom modal.
         */
        function hideNameModal() {
            studentNameInput.value = ''; // Clear input on close
            nameModalOverlay.classList.remove('flex');
            nameModalOverlay.classList.add('hidden');
        }

        /**
         * Handles the "Save Record" click inside the modal.
         */
        function handleModalSubmit() {
            const studentName = studentNameInput.value.trim();
            const remainingTime = timerDisplay.textContent; // Get the time when the button is pressed

            if (studentName.length > 0) {
                addRecordToTable(studentName, remainingTime);
                hideNameModal(); // Close modal and clear input
            } else {
                alertMessage("Please enter a name to save the record.");
            }
        }

        // --- Timer Logic ---

        /**
         * Parses input time, sets the target end time, and starts the countdown.
         */
        function setTimer() {
            // Stop any existing timer to reset
            if (timerInterval) {
                clearInterval(timerInterval);
            }

            try {
                const hours = parseInt(hInput.value || 0);
                const minutes = parseInt(mInput.value || 0);
                const seconds = parseInt(sInput.value || 0);

                const durationInSeconds = (hours * 3600) + (minutes * 60) + seconds;
                const newTitle = titleInput.value.trim();

                if (durationInSeconds <= 0) {
                    timerDisplay.textContent = "00:00:00.0";
                    timerDisplay.classList.add('text-red-500');
                    alertMessage("Please set a valid time greater than zero.");
                    return;
                }

                // 1. Set the Title
                mainTitle.textContent = newTitle || "Countdown Timer";

                // 2. Hide Input Section and Show Timer
                inputSection.classList.add('hidden');
                timerDisplayContainer.classList.remove('hidden');

                // Calculate the exact time when the countdown should end
                targetEndTime = Date.now() + (durationInSeconds * 1000);
                isRunning = true;
                
                // Update button states
                submitButton.disabled = false;
                submitButton.classList.remove('disabled:bg-gray-400', 'disabled:shadow-none');

                // Initial color state (will be set properly by updateTimer)
                timerDisplay.classList.remove('text-red-500', 'text-gray-500');
                
                // Start the high-precision interval (100ms)
                timerInterval = setInterval(updateTimer, 100);
                updateTimer(); // Initial call to display time immediately

            } catch (error) {
                alertMessage("Invalid time input. Please use numbers only.");
            }
        }

        /**
         * Calculates the remaining time and updates the display, changing color if < 5 minutes.
         */
        function updateTimer() {
            if (!isRunning) {
                return;
            }

            const now = Date.now();
            let timeRemainingMs = targetEndTime - now;
            
            // Define 5 minutes (300,000 milliseconds)
            const fiveMinutesMs = 5 * 60 * 1000; 

            // --- Color Logic ---
            // Clear previous color classes
            timerDisplay.classList.remove('text-green-400', 'text-red-500', 'text-gray-500', 'animate-pulse');

            if (timeRemainingMs <= 0) {
                // TIMER FINISHED: Red and static
                clearInterval(timerInterval);
                isRunning = false;
                timerDisplay.textContent = "00:00:00.0";
                timerDisplay.classList.add('text-red-500'); 
                
                // 3. Show Input Section to allow reset
                inputSection.classList.remove('hidden');
                timerDisplayContainer.classList.add('hidden');
                
                // Reset buttons
                setButton.disabled = false;
                setButton.classList.remove('opacity-50', 'cursor-not-allowed');
                submitButton.disabled = true;
                submitButton.classList.add('disabled:bg-gray-400', 'disabled:shadow-none');
                
                alertMessage("Time's up!");
                return;
            } 
            
            // TIMER RUNNING: Check for warning state
            if (timeRemainingMs <= fiveMinutesMs) {
                timerDisplay.classList.add('text-red-500'); 
            } else {
                timerDisplay.classList.add('text-green-400');
            }
            
            // --- Time Calculation ---
            const totalSeconds = timeRemainingMs / 1000;
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = Math.floor(totalSeconds % 60);
            const tenths = Math.floor((totalSeconds * 10) % 10); 

            const timeStr = [
                String(hours).padStart(2, '0'),
                String(minutes).padStart(2, '0'),
                String(seconds).padStart(2, '0')
            ].join(':') + `.${tenths}`;

            timerDisplay.textContent = timeStr;
        }

        /**
         * Adds a new row to the submission log table.
         * @param {string} name - The student's name.
         * @param {string} time - The remaining time (HH:MM:SS.T).
         */
        function addRecordToTable(name, time) {
            // Remove the 'No submissions yet' message if it exists
            if (noRecordsMessage) {
                noRecordsMessage.classList.add('hidden');
            }

            const newRow = recordsBody.insertRow(0); // Insert at the top
            
            // Name cell (left aligned)
            const nameCell = newRow.insertCell(0);
            nameCell.innerHTML = `<span class="font-semibold text-gray-800">${name}</span>`;
            nameCell.className = "px-6 py-3 whitespace-nowrap text-sm text-left";

            // Time Remaining cell (right aligned, monospace for alignment)
            // Extract minutes left from the time string (format: HH:MM:SS.T)
            let minutesLeft = 0;
            try {
                const parts = time.split(':');
                if (parts.length >= 2) {
                    const hours = parseInt(parts[0], 10) || 0;
                    const minutes = parseInt(parts[1], 10) || 0;
                    minutesLeft = hours * 60 + minutes;
                }
            } catch (e) {
                minutesLeft = 0;
            }

            const timeCell = newRow.insertCell(1);
            timeCell.textContent = minutesLeft + " min";
            timeCell.className = "px-6 py-3 whitespace-nowrap text-sm text-right font-bold text-blue-600";
        }

        /**
         * Simple custom alert box implementation (since alert() is discouraged).
         * Flashes text on the timer display.
         */
        function alertMessage(message) {
            console.error("ALERT:", message);
            // Flashing temporary message on the timer display
            const originalText = timerDisplay.textContent;
            
            // Find the current color class to restore it later
            const colorClasses = ['text-green-400', 'text-red-500', 'text-gray-500'];
            const originalColor = colorClasses.find(cls => timerDisplay.classList.contains(cls)) || 'text-gray-500';

            // Apply warning pulse
            timerDisplay.textContent = message;
            timerDisplay.classList.remove(...colorClasses);
            timerDisplay.classList.add('text-yellow-500', 'animate-pulse');

            setTimeout(() => {
                timerDisplay.textContent = originalText;
                timerDisplay.classList.remove('text-yellow-500', 'animate-pulse');
                timerDisplay.classList.add(originalColor);
            }, 2000);
        }

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            // Ensure input values are correct on load
            hInput.value = '01';
            mInput.value = '30';
            sInput.value = '00';
            
            // Initial style setup for disabled button and gray timer
            submitButton.classList.add('disabled:bg-gray-400', 'disabled:shadow-none');
            timerDisplay.classList.add('text-gray-500');
            
            // Initially hide the timer display container until the timer is set
            timerDisplayContainer.classList.add('hidden');
        });
        
    </script>

</body>
</html>
