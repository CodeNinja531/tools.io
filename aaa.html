<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chaotic Classroom Timer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=JetBrains+Mono:wght@700&family=Bangers&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9;
            overflow: hidden; /* Crucial: Hides scrollbars when words fly off screen */
            transition: background-color 1s ease;
        }

        .tabular-nums { font-family: 'JetBrains Mono', monospace; font-variant-numeric: tabular-nums; }
        
        /* --- UI Toggles --- */
        .toggle-checkbox:checked { right: 0; border-color: #ef4444; }
        .toggle-checkbox:checked + .toggle-label { background-color: #ef4444; }
        
        /* --- NEW CHAOS ANIMATIONS --- */

        /* 1. Fly Left to Right */
        @keyframes flyRight {
            0% { transform: translateX(-100vw) rotate(var(--rot-start)) scale(0.5); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateX(100vw) rotate(var(--rot-end)) scale(1.2); opacity: 0; }
        }

        /* 2. Fly Top to Bottom */
        @keyframes flyDown {
            0% { transform: translateY(-100vh) rotate(var(--rot-start)); opacity: 0; }
            10% { opacity: 1; }
            100% { transform: translateY(100vh) rotate(var(--rot-end)); opacity: 0; }
        }

        /* 3. Pop up and Wander Wildly */
        @keyframes wander {
            0% { transform: scale(0) translate(0,0) rotate(0deg); opacity: 0; }
            20% { transform: scale(1.2) translate(0,0) rotate(var(--rot-start)); opacity: 1; }
            100% { transform: scale(1) translate(var(--move-x), var(--move-y)) rotate(var(--rot-end)); opacity: 1; }
        }

        .chaos-word {
            position: fixed;
            font-family: 'Bangers', cursive;
            pointer-events: none; /* Clicks pass through */
            z-index: 50;
            text-shadow: 3px 3px 0px #000;
            white-space: nowrap;
            will-change: transform;
        }

        /* --- DESTRUCTION ANIMATIONS --- */
        @keyframes hingeFall {
            0% { transform-origin: top left; animation-timing-function: ease-in-out; }
            20% { transform: rotate(80deg); transform-origin: top left; }
            40% { transform: rotate(60deg); transform-origin: top left; opacity: 1; }
            60% { transform: rotate(80deg); transform-origin: top left; }
            80% { transform: rotate(60deg); transform-origin: top left; }
            100% { transform: translateY(1500px) rotate(70deg); opacity: 0; }
        }

        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }

        .flash-overlay {
            position: fixed; inset: 0; background: white; opacity: 0; pointer-events: none; z-index: 100;
            transition: opacity 0.1s;
        }

        .animate-shake { animation: shake 0.5s infinite; }
        .animate-hinge { animation: hingeFall 3s ease-in forwards; }

    </style>
</head>
<body id="main-body" class="min-h-screen flex flex-col items-center justify-center p-4 md:p-8 text-slate-800 relative">

    <div id="flash-overlay" class="flash-overlay"></div>

    <div id="app-container" class="w-full max-w-4xl bg-white shadow-2xl rounded-3xl p-6 md:p-10 border border-slate-200 transition-all duration-300 relative z-10">
        
        <div class="flex justify-between items-center mb-6">
            <h1 id="main-title" class="text-2xl md:text-4xl font-extrabold text-slate-800 tracking-tight">
                Activity Timer
            </h1>
            
            <div class="flex items-center gap-3 bg-slate-100 px-4 py-2 rounded-lg">
                <span class="text-xs font-bold uppercase tracking-wider text-slate-500">Standard</span>
                <div class="relative inline-block w-12 mr-2 align-middle select-none transition duration-200 ease-in">
                    <input type="checkbox" name="toggle" id="mode-toggle" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer border-slate-300 transition-all duration-300"/>
                    <label for="mode-toggle" class="toggle-label block overflow-hidden h-6 rounded-full bg-slate-300 cursor-pointer transition-colors duration-300"></label>
                </div>
                <span class="text-xs font-bold uppercase tracking-wider text-red-600">Aggressive</span>
            </div>
        </div>

        <div id="input-section">
            <div class="mb-6">
                <label class="block text-sm font-bold text-slate-500 uppercase tracking-wide mb-2">Activity Title</label>
                <input id="title-input" type="text" value="Folding Test"
                       class="w-full p-4 text-lg rounded-xl bg-slate-50 border-2 border-slate-200 focus:border-blue-500 outline-none font-semibold text-slate-700"/>
            </div>

            <div class="bg-blue-50/50 rounded-2xl p-6 border border-blue-100">
                <div class="flex flex-col sm:flex-row items-center justify-center gap-4">
                    <div class="flex items-center gap-2">
                        <div class="flex flex-col items-center">
                            <input id="h-input" type="number" min="0" value="00" class="w-20 p-3 text-center text-2xl font-bold rounded-xl border-2 border-slate-200 focus:border-blue-500 outline-none tabular-nums"/>
                            <span class="text-xs font-bold text-slate-400 mt-1">HR</span>
                        </div>
                        <span class="text-2xl font-bold text-slate-300 mb-6">:</span>
                        <div class="flex flex-col items-center">
                            <input id="m-input" type="number" min="0" value="10" class="w-20 p-3 text-center text-2xl font-bold rounded-xl border-2 border-slate-200 focus:border-blue-500 outline-none tabular-nums"/>
                            <span class="text-xs font-bold text-slate-400 mt-1">MIN</span>
                        </div>
                        <span class="text-2xl font-bold text-slate-300 mb-6">:</span>
                        <div class="flex flex-col items-center">
                            <input id="s-input" type="number" min="0" value="00" class="w-20 p-3 text-center text-2xl font-bold rounded-xl border-2 border-slate-200 focus:border-blue-500 outline-none tabular-nums"/>
                            <span class="text-xs font-bold text-slate-400 mt-1">SEC</span>
                        </div>
                    </div>
                    <button onclick="setTimer()" class="mt-2 sm:mt-0 sm:ml-4 px-8 py-4 bg-slate-900 text-white font-bold rounded-xl hover:bg-slate-800 transition shadow-lg">
                        Set Timer
                    </button>
                </div>
            </div>
        </div>

        <div id="timer-section" class="hidden flex-col items-center w-full">
            
            <div class="w-full relative group">
                <button onclick="cycleSize()" title="Change Timer Size" 
                        class="absolute top-4 left-4 z-10 p-2 bg-slate-700/50 hover:bg-slate-600 text-white rounded-lg transition backdrop-blur-sm">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 3h6v6"/><path d="M9 21H3v-6"/><path d="M21 3l-7 7"/><path d="M3 21l7-7"/></svg>
                </button>

                <button onclick="resetToInput()" class="absolute top-4 right-4 z-10 px-3 py-1 bg-slate-700/50 hover:bg-slate-600 text-white text-sm font-bold rounded-lg transition backdrop-blur-sm">
                    Edit Time
                </button>

                <div id="timer-box" class="w-full bg-slate-900 rounded-3xl flex flex-col justify-center items-center overflow-hidden transition-all duration-300 p-8 md:p-12">
                    <p id="timer-display" class="tabular-nums font-bold text-white tracking-tighter leading-none select-none transition-all duration-300 text-5xl md:text-7xl">
                        00:00:00.0
                    </p>
                    
                    <div id="add-buttons" class="flex gap-4 mt-6 opacity-50 group-hover:opacity-100 transition-opacity">
                        <button onclick="adjustTime(1)" class="px-4 py-2 bg-slate-700 text-white font-bold rounded-lg hover:bg-slate-600 active:scale-95 transition text-sm">+1 Min</button>
                        <button onclick="adjustTime(5)" class="px-4 py-2 bg-slate-700 text-white font-bold rounded-lg hover:bg-slate-600 active:scale-95 transition text-sm">+5 Min</button>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 w-full mt-6">
                <button id="start-stop-btn" onclick="toggleTimer()"
                        class="w-full py-4 text-xl font-bold text-white rounded-xl shadow-lg transition transform active:scale-95 bg-green-600 hover:bg-green-700">
                    Start
                </button>
                <button id="submit-btn" onclick="openModal()" disabled
                        class="w-full py-4 text-xl font-bold text-white rounded-xl shadow-lg transition transform active:scale-95 bg-blue-600 hover:bg-blue-700 disabled:bg-slate-200 disabled:text-slate-400 disabled:shadow-none">
                    Record Submission
                </button>
            </div>
        </div>

        <div id="log-section" class="border-t-2 border-slate-100 pt-8 mt-8 w-full">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-slate-700">Student Logs</h2>
                <button onclick="clearLogs()" class="text-xs text-red-400 hover:text-red-600 font-semibold">Clear History</button>
            </div>
            <div class="overflow-hidden rounded-xl border border-slate-200 shadow-sm bg-white">
                <table class="min-w-full divide-y divide-slate-200">
                    <tbody id="records-body" class="bg-white divide-y divide-slate-100 tabular-nums"></tbody>
                </table>
                <div id="empty-state" class="p-8 text-center text-slate-400 italic">No submissions yet.</div>
            </div>
        </div>
    </div>

    <div id="void-reset-container" class="fixed inset-0 hidden flex-col items-center justify-center z-50">
        <h2 class="text-5xl font-black text-red-600 mb-8 font-[Bangers] tracking-widest animate-pulse">SYSTEM DESTROYED</h2>
        <button onclick="location.reload()" class="px-8 py-4 bg-white text-black font-bold text-xl rounded-full hover:scale-110 transition shadow-[0_0_30px_rgba(255,255,255,0.5)]">
            INITIALIZE NEW TIMER
        </button>
    </div>

    <div id="modal-overlay" class="fixed inset-0 bg-slate-900/80 backdrop-blur-sm hidden items-center justify-center z-[60]">
        <div class="bg-white p-8 rounded-2xl shadow-2xl w-full max-w-sm">
            <h3 class="text-2xl font-bold text-slate-800 mb-2">Record Result</h3>
            <input id="student-name" type="text" class="w-full p-4 border-2 border-slate-200 rounded-xl mb-6 outline-none focus:border-blue-500" placeholder="Student Name" onkeydown="if(event.key === 'Enter') saveRecord()"/>
            <div class="flex gap-3">
                <button onclick="closeModal()" class="flex-1 py-3 text-slate-600 font-bold hover:bg-slate-100 rounded-xl">Cancel</button>
                <button onclick="saveRecord()" class="flex-1 py-3 bg-blue-600 text-white font-bold rounded-xl hover:bg-blue-700">Save</button>
            </div>
        </div>
    </div>

    <script>
        // --- State ---
        let state = {
            durationMs: 0,
            remainingMs: 0,
            endTime: null,
            timerId: null,
            isRunning: false,
            sizeLevel: 0,
            aggressiveMode: false
        };

        const els = {
            body: document.getElementById('main-body'),
            container: document.getElementById('app-container'),
            inputSection: document.getElementById('input-section'),
            timerSection: document.getElementById('timer-section'),
            timerBox: document.getElementById('timer-box'),
            timerDisplay: document.getElementById('timer-display'),
            startStopBtn: document.getElementById('start-stop-btn'),
            submitBtn: document.getElementById('submit-btn'),
            flash: document.getElementById('flash-overlay'),
            voidContainer: document.getElementById('void-reset-container'),
            recordsBody: document.getElementById('records-body'),
            emptyState: document.getElementById('empty-state'),
            modal: document.getElementById('modal-overlay'),
            nameInput: document.getElementById('student-name'),
            modeToggle: document.getElementById('mode-toggle')
        };

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        // --- NEW: Add Time Logic ---
        function adjustTime(minutes) {
            const msToAdd = minutes * 60 * 1000;
            if (state.isRunning) {
                state.endTime += msToAdd;
            } else {
                state.remainingMs += msToAdd;
            }
            const currentDiff = state.isRunning ? (state.endTime - Date.now()) : state.remainingMs;
            els.timerDisplay.classList.add('text-green-400');
            setTimeout(() => {
                if(currentDiff > 60000) els.timerDisplay.classList.remove('text-green-400');
            }, 300);
            updateDisplay(currentDiff);
        }

        // --- Toggle Size ---
        function cycleSize() {
            state.sizeLevel = (state.sizeLevel + 1) % 3;
            const display = els.timerDisplay;
            const box = els.timerBox;
            display.className = "tabular-nums font-bold text-white tracking-tighter leading-none select-none transition-all duration-300";
            if (state.sizeLevel === 0) {
                display.classList.add("text-5xl", "md:text-7xl");
                box.classList.remove("py-20", "py-32"); box.classList.add("p-8", "md:p-12");
            } else if (state.sizeLevel === 1) {
                display.classList.add("text-7xl", "md:text-9xl");
                box.classList.remove("p-8", "md:p-12"); box.classList.add("py-20");
            } else {
                display.classList.add("text-8xl", "md:text-[10rem]");
                box.classList.remove("p-8", "md:p-12", "py-20"); box.classList.add("py-32");
            }
        }

        // --- Timer Core ---
        function setTimer() {
            const h = parseInt(document.getElementById('h-input').value) || 0;
            const m = parseInt(document.getElementById('m-input').value) || 0;
            const s = parseInt(document.getElementById('s-input').value) || 0;
            state.aggressiveMode = els.modeToggle.checked;
            if (h+m+s === 0) return alert("Enter time!");
            state.durationMs = ((h * 3600) + (m * 60) + s) * 1000;
            state.remainingMs = state.durationMs;
            updateDisplay(state.remainingMs);
            els.inputSection.classList.add('hidden');
            els.timerSection.classList.remove('hidden');
            els.timerSection.classList.add('flex');
        }

        function toggleTimer() {
            state.isRunning ? pauseTimer() : startTimer();
        }

        function startTimer() {
            if (state.remainingMs <= 0) return;
            state.isRunning = true;
            state.endTime = Date.now() + state.remainingMs;
            els.startStopBtn.textContent = "Stop";
            els.startStopBtn.className = "w-full py-4 text-xl font-bold text-white rounded-xl shadow-lg transition transform active:scale-95 bg-red-500 hover:bg-red-600";
            els.submitBtn.disabled = false;
            if (audioCtx.state === 'suspended') audioCtx.resume();
            state.timerId = setInterval(tick, 20);
        }

        function pauseTimer() {
            state.isRunning = false;
            clearInterval(state.timerId);
            state.remainingMs = Math.max(0, state.endTime - Date.now());
            els.startStopBtn.textContent = "Resume";
            els.startStopBtn.className = "w-full py-4 text-xl font-bold text-white rounded-xl shadow-lg transition transform active:scale-95 bg-green-600 hover:bg-green-700";
            els.submitBtn.disabled = true;
        }

        function tick() {
            const diff = state.endTime - Date.now();
            if (diff <= 0) {
                state.remainingMs = 0;
                clearInterval(state.timerId);
                updateDisplay(0);
                if (state.aggressiveMode) {
                    triggerChaosSequence();
                } else {
                    triggerStandardFinish();
                }
            } else {
                updateDisplay(diff);
                if (diff < 60000) {
                    els.timerDisplay.classList.add("text-red-400");
                } else {
                    els.timerDisplay.classList.remove("text-red-400");
                }
            }
        }

        function updateDisplay(ms) {
            if (ms < 0) ms = 0;
            const totalSec = Math.floor(ms / 1000);
            const h = Math.floor(totalSec / 3600);
            const m = Math.floor((totalSec % 3600) / 60);
            const s = totalSec % 60;
            const tenths = Math.floor((ms % 1000) / 100);
            const timeStr = [h,m,s].map(v => String(v).padStart(2,'0')).join(':');
            els.timerDisplay.textContent = `${timeStr}.${tenths}`;
        }

        // --- Finish Sequences ---
        function triggerStandardFinish() {
            state.isRunning = false;
            els.timerDisplay.classList.remove("text-red-400");
            els.timerDisplay.classList.add("text-red-600", "animate-pulse");
            playBeep();
            alert("Time is up!");
            els.startStopBtn.textContent = "Reset";
            els.startStopBtn.onclick = () => location.reload();
        }

        function triggerChaosSequence() {
            state.isRunning = false;
            els.timerDisplay.classList.add("text-red-600");
            els.startStopBtn.style.display = 'none';
            els.submitBtn.style.display = 'none';
            document.getElementById('add-buttons').style.display = 'none';

            playAlarm();

            // Spawn chaos words
            let count = 0;
            const chaosInterval = setInterval(() => {
                spawnTimesUpWord();
                count++;
                if (count > 50) clearInterval(chaosInterval);
            }, 80); // Faster spawn

            setTimeout(() => {
                triggerDestruction();
            }, 5000);
        }

        function triggerDestruction() {
            els.flash.style.opacity = '1';
            setTimeout(() => els.flash.style.opacity = '0', 200);

            els.container.classList.add('animate-shake');
            els.body.style.backgroundColor = "#000000";

            setTimeout(() => {
                els.container.classList.remove('animate-shake');
                els.container.classList.add('animate-hinge');
                playExplosion();
                document.querySelectorAll('.chaos-word').forEach(el => el.remove());
                setTimeout(() => {
                    els.voidContainer.classList.remove('hidden');
                    els.voidContainer.classList.add('flex');
                }, 1500);
            }, 500);
        }

        // --- IMPROVED ANIMATION LOGIC ---
        function spawnTimesUpWord() {
            const word = document.createElement('div');
            word.textContent = "TIME'S UP!";
            word.className = "chaos-word text-4xl md:text-7xl font-black";
            
            // Random Color
            const hue = Math.floor(Math.random() * 360);
            word.style.color = `hsl(${hue}, 100%, 50%)`;

            // Random Rotation Start/End
            const startRot = (Math.random() * 60 - 30) + 'deg';
            const endRot = (Math.random() * 60 - 30) + 'deg';
            word.style.setProperty('--rot-start', startRot);
            word.style.setProperty('--rot-end', endRot);

            // Choose Animation Type
            const type = Math.random();

            if (type < 0.33) {
                // TYPE 1: FLY LEFT TO RIGHT
                word.style.left = '0'; // Starting point handled by transform
                word.style.top = (Math.random() * 80 + 10) + '%';
                word.style.animation = `flyRight ${Math.random() * 1.5 + 1}s linear forwards`;
            } else if (type < 0.66) {
                // TYPE 2: FLY TOP TO BOTTOM
                word.style.top = '0';
                word.style.left = (Math.random() * 80 + 10) + '%';
                word.style.animation = `flyDown ${Math.random() * 1.5 + 1}s linear forwards`;
            } else {
                // TYPE 3: WANDER/FLOAT
                word.style.left = (Math.random() * 80 + 10) + '%';
                word.style.top = (Math.random() * 80 + 10) + '%';
                
                // Random wander direction
                const moveX = (Math.random() * 200 - 100) + 'px';
                const moveY = (Math.random() * 200 - 100) + 'px';
                word.style.setProperty('--move-x', moveX);
                word.style.setProperty('--move-y', moveY);
                
                word.style.animation = `wander ${Math.random() * 2 + 1}s ease-out forwards`;
            }

            document.body.appendChild(word);
        }

        // --- Audio ---
        function playBeep() {
            if(audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.frequency.setValueAtTime(880, audioCtx.currentTime);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            osc.start(); osc.stop(audioCtx.currentTime + 0.5);
        }

        function playAlarm() {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(400, audioCtx.currentTime);
            osc.frequency.linearRampToValueAtTime(600, audioCtx.currentTime + 0.1);
            gain.gain.value = 0.2;
            osc.start(); osc.stop(audioCtx.currentTime + 3);
        }

        function playExplosion() {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.type = 'triangle';
            osc.frequency.setValueAtTime(100, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(10, audioCtx.currentTime + 1);
            gain.gain.setValueAtTime(1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 1);
            osc.start(); osc.stop(audioCtx.currentTime + 1.5);
        }

        // --- UI Helpers ---
        function resetToInput() {
            location.reload(); 
        }

        function openModal() {
            if(!state.isRunning) return;
            pauseTimer();
            els.modal.classList.remove('hidden');
            els.modal.classList.add('flex');
            els.nameInput.focus();
        }

        function closeModal() {
            els.modal.classList.add('hidden');
            els.modal.classList.remove('flex');
            if(state.remainingMs > 0) startTimer();
        }

        function saveRecord() {
            const name = els.nameInput.value.trim();
            if(!name) return;
            const row = document.createElement('tr');
            row.innerHTML = `<td class="px-6 py-4 text-sm font-semibold">${name}</td><td class="px-6 py-4 text-right text-sm font-bold text-blue-600 font-[JetBrains_Mono]">${els.timerDisplay.textContent}</td>`;
            els.recordsBody.prepend(row);
            els.emptyState.classList.add('hidden');
            els.nameInput.value = '';
            closeModal();
        }

        function clearLogs() {
            els.recordsBody.innerHTML = '';
            els.emptyState.classList.remove('hidden');
        }
    </script>
</body>
</html>